{{ define "main" }}

{{ if .Title }}
<h1>{{ .Title }}</h1>
{{ end }}

{{ if .Content }}
<div class="mb-5">
    {{ .Content }}
</div>
{{ end }}

{{/* Specific logic for Blog section with badges filter */}}
{{ if eq .Section "blogue" }}
<div id="tag-filter-container" class="mb-4">
    <!-- Tags will be injected by JS if we keep the JS logic, or we can pre-render categories here. 
           For now, let's keep the user's specific blog layout style. -->
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        console.log("Blog filter script running");
        const articles = document.querySelectorAll('article');
        const tagContainer = document.getElementById('tag-filter-container');

        if (!tagContainer) {
            console.log("Tag container not found");
            return;
        }

        const tags = new Set();
        console.log("Found articles:", articles.length);

        // Extract tags from articles
        articles.forEach(article => {
            const badges = article.querySelectorAll('.badge');
            badges.forEach(badge => {
                const tagText = badge.textContent.trim();
                tags.add(tagText);
                badge.style.cursor = 'pointer';
                badge.addEventListener('click', (e) => {
                    e.stopPropagation();
                    filterByTag(tagText);
                });
            });
        });

        console.log("Found tags:", tags);

        // Create "All" button
        const allBtn = document.createElement('button');
        allBtn.className = 'btn btn-outline-primary btn-sm active filter-btn me-2 mb-2';
        allBtn.textContent = 'Ver todos';
        allBtn.addEventListener('click', () => filterByTag('all'));
        tagContainer.appendChild(allBtn);

        // Create button for each tag
        Array.from(tags).sort().forEach(tag => {
            const btn = document.createElement('button');
            btn.className = 'btn btn-outline-secondary btn-sm filter-btn me-2 mb-2';
            btn.textContent = tag;
            btn.addEventListener('click', () => filterByTag(tag));
            tagContainer.appendChild(btn);
        });

        function filterByTag(selectedTag) {
            console.log("Filtering by:", selectedTag);

            // Update button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.textContent === selectedTag || (selectedTag === 'all' && btn.textContent === 'Ver todos')) {
                    btn.classList.add('active');
                    if (selectedTag === 'all') {
                        btn.classList.replace('btn-outline-primary', 'btn-primary');
                    } else {
                        btn.classList.replace('btn-outline-secondary', 'btn-secondary');
                    }
                } else {
                    btn.classList.remove('active');
                    btn.classList.replace('btn-primary', 'btn-outline-primary');
                    btn.classList.replace('btn-secondary', 'btn-outline-secondary');
                }
            });

            // Update badge highlights
            document.querySelectorAll('.badge').forEach(badge => {
                if (badge.textContent.trim() === selectedTag) {
                    badge.classList.remove('bg-light', 'text-secondary');
                    badge.classList.add('bg-primary', 'text-white');
                } else {
                    badge.classList.remove('bg-primary', 'text-white');
                    badge.classList.add('bg-light', 'text-secondary');
                }
            });

            // Filter articles
            articles.forEach(article => {
                if (selectedTag === 'all') {
                    article.classList.remove('d-none');
                } else {
                    const articleTags = Array.from(article.querySelectorAll('.badge')).map(b => b.textContent.trim());
                    if (articleTags.includes(selectedTag)) {
                        article.classList.remove('d-none');
                    } else {
                        article.classList.add('d-none');
                    }
                }
            });
        }
    });
</script>
<section class="blog-entradas">
    {{ range .Pages.ByDate.Reverse }}
    <article id="{{ .Date.Format " 02/01/2006" }}" class="card mb-4 rounded shadow-sm border mx-3">
        <div class="card-body">
            <div class="d-flex align-items-center mb-2">
                <div class="rounded-circle bg-primary text-white d-flex justify-content-center align-items-center me-2"
                    style="width: 36px; height: 36px;">
                    üóìÔ∏è
                </div>
                <h5 class="card-title mb-0 fw-bold">{{ .Title }}</h5>
                <!-- Using Title as Date per user's old format, or Date -->
            </div>
            <div class="card-text text-muted">
                {{ .Content }}
                <!-- Note: In Hugo list templates, .Content is the page content. 
                 If we put the post body in the markdown content, it shows here. -->
            </div>
        </div>
        <div class="text-end mt-3 p-3 pt-0">
            {{ range .Params.tags }}
            <span class="badge bg-light text-secondary">#{{ . }}</span>
            {{ end }}
        </div>
    </article>
    {{ end }}
</section>

{{/* Logic for Informatica (Tutorials list) */}}
{{ else if eq .Section "informatica" }}
<h2>Artigos de inform√°tica</h2>
<menu>
    {{ range .Pages }}
    <li><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>
    {{ end }}
</menu>

{{/* Hardcoded external links from old index.html - ideally these move to a data file or _index.md content */}}
<h2>Programas e xogos</h2>
<menu>
    <li>U-la Carmela? Viaxa por toda a Galiza para atopar a Carmela e salvar o cocido. <a
            href="https://trevizer.itch.io/u-la-carmela">Enlace</a></li>
    <li>RythmMaker: Un programa para crear ritmos musicais. <a href="https://trevizer.itch.io/rythmmaker">Enlace</a>
    </li>
    <li>Escape Espacial 1: Unha aventura conversacional con gr√°ficos pixelart. (ESP) <a
            href="https://trevizer.itch.io/escape-espacial-i">Enlace</a></li>
    <li>Space Gauntlet. Un boceto de videoxogo inspirado no Gauntlet (1985) <a
            href="https://trevizer.itch.io/space-gauntlet">Enlace</a></li>
    <li>Demasiado Larga. Un xogo para unha jam feito nun fin de semana. <a
            href="https://trevizer.itch.io/demasiado-larga-medieval">Enlace</a></li>
</menu>

<p>En xeral podes ver as mi√±as cousas:
<menu>
    <li><a href="https://trevizer.itch.io/">P√°xina de itch.io</a></li>
    <li><a href="https://codeberg.org/Trevizer/">P√°xina de Codeberg</a></li>
    <li><a href="https://play.google.com/store/apps/developer?id=Hugo+Alexandre">Aplicaci√≥ns na Play Store</a></li>
</menu>
</p>

{{/* Logic for Reviews (Libros/Cine) */}}
{{ else }}
{{ range .Pages }}
<article id="{{ with .File }}{{ .TranslationBaseName }}{{ else }}{{ .Title | urlize }}{{ end }}"
    class="bg-white p-4 rounded shadow-sm border mx-3 mb-4">
    <header class="mb-4">
        <h2 class="text-2xl font-semibold text-gray-800"><a href="{{ .RelPermalink }}"
                style="color:inherit; text-decoration:none">{{ .Title }}</a></h2>
    </header>
    <div class="space-y-4 text-gray-700 leading-relaxed">
        {{ .Content }}
    </div>

    {{ if .Params.meta }}
    <div class="mt-6 border-t pt-4 text-sm text-gray-600">
        <ul class="space-y-1">
            {{ range $key, $value := .Params.meta }}
            <li><strong>{{ $key | humanize }}:</strong> {{ $value }}</li>
            {{ end }}
        </ul>
    </div>
    {{ end }}

</article>
{{ end }}
{{ end }}

{{ end }}